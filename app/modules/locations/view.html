<div class="page">
  <div class="locations">
    <header>
      <div class="appTitle">
        <h1>Weather Watcher</h1>
        <button class="demoMode" ng-hide="locationsCtrl.demoMode" ng-click="locationsCtrl.toggleDemo()">Go to Demo Mode</button>
        <button class="demoMode" ng-show="locationsCtrl.demoMode" ng-click="locationsCtrl.toggleDemo()">Leave Demo Mode</button>

      </div>

      <ul class="userInfo">
        <li>{{ locationsCtrl.user.password.email }} </li>
        <li>
          <button class="logout" ng-click="locationsCtrl.logout()">Log Out</button>
        </li>
      </ul>

    </header>

    <button class="addNew" ng-hide="locationsCtrl.adding" ng-click="locationsCtrl.toggleAdding()">Add New Location</button>



    <div class="addLocationForm" ng-show="locationsCtrl.adding">
      <i class="fa fa-times" aria-hidden="true" ng-click="locationsCtrl.toggleAdding()"></i>
      <form ng-submit="locationsCtrl.addLocation()">
        <input type="text" placeholder='Name this location' ng-model="locationsCtrl.newLocation.title">
        <input type="text" placeholder="street address" ng-model="locationsCtrl.newLocation.address">
        <input type="text" placeholder="city" ng-model="locationsCtrl.newLocation.city">
        <!--autocomplete?-->
        <input type="text" placeholder="state" list="states" ng-model="locationsCtrl.newLocation.state" name="chooseState" autocomplete="true">
          <datalist id="states">
            <option ng-repeat="state in locationsCtrl.states" value="{{ state }}"></option>

          </datalist>
          <!-- <select chosen multiple data-placeholder="state" id="states" ng-model="locationsCtrl.newLocation.state">
  <option value="choose"></option>
  <option ng-repeat="state in locationsCtrl.states"="{{ state }}">{{ state }}</option>

</select> -->
        <input type="submit" value="Add Location">
      </form>
    </div>
    <button ng-hide="locationsCtrl.adding" ng-if="locationsCtrl.markers[0].coords"
      ng-class="{'viewAll': !locationsCtrl.showList, 'closeList': locationsCtrl.showList}"
      ng-click="locationsCtrl.toggleList()">Toggle List View
    </button>

    <div id="locationsListContainer"
      ng-class="{ 'animated slideInLeft': locationsCtrl.showList, 'animated slideOutLeft': locationsCtrl.isFading }"
      ng-show="locationsCtrl.showList">
      <ul class="locationsList" ng-repeat="place in locationsCtrl.locations">
        <div ng-hide="place.editing" class="locationInfo">
          <li class="title">{{ place.title }}</li>
          <li class="address">{{ place.address }}</li>
          <li class="city">{{ place.city }},</li>
          <li class="state">{{ place.state }}</li>

        </div>
        
        <div ng-hide="place.editing" class="listButtons">
          <li>
            <button class="listButton" ng-click="locationsCtrl.changeLocation(place)">Edit</button>
          </li>
          <li>
            <button class="listButton" ng-click="locationsCtrl.deleteLocation(place)">Delete</button>
          </li>
        </div>
        <div ng-show="place.editing" class="editForm">
          <form ng-submit="locationsCtrl.saveLocation(place)">
            <input type="text" placeholder='Name this location' ng-model="place.title">
            <input type="text" placeholder="street address" ng-model="place.address">
            <input type="text" placeholder="city" ng-model="place.city">
            <input type="text" placeholder="state" ng-model="place.state">
            <input type="submit" value="Edit Location">
          </form>
        </div>
      </ul>

    </div>
  </div>

  <!--TODO: make infoWindow close on click-->
  <!--TODO: add currentPosition code to getMarkers so map fits around all markers including current position-->
  <div class="locationsMap" ng-if="locationsCtrl.markers[0].coords || locationsCtrl.currentPosition.coords" ng-hide="locationsCtrl.showList">
    <span class="demo" ng-if="locationsCtrl.demoMode">Demo Mode</span>
    <ui-gmap-google-map center='locationsCtrl.map.center' zoom='locationsCtrl.map.zoom'>

      <ui-gmap-markers models="locationsCtrl.markers" coords="'coords'" fit="true" click="onClick" options="'options'">
        <ui-gmap-windows show="show">
          <div class="infoWindow" ng-non-bindable>
            <ul class="windowLocation">
              <li class="windowName">
                {{ name }}</li>
              <li class="address">{{ address }}</li>
              <li class="cityState"><span class="city">{{ city }}</span>, <span class="state">{{ state }}</span></li>
            </ul>
            <ul class="locationWeather">
              <li><img class="weatherIcon" src="{{ image }}" alt="{{ condition }}"></li>
              <li>{{ temp | number:0 }}°</li>
              <li class="condition">{{ condition }}</li>
              <li class="time">{{ time | date: 'short' }}</li>
            </ul>
          </div>
        </ui-gmap-windows>
      </ui-gmap-markers>

      <ui-gmap-marker class="currentPosition" ng-if="locationsCtrl.currentPosition" coords="locationsCtrl.currentPosition.coords" idKey="locationsCtrl.currentPosition.id" options="locationsCtrl.currentPosition.options">
        <ui-gmap-window>
          <div class="infoWindow">
            <ul class="currentWindow">
              <li>{{ locationsCtrl.currentPosition.title }}</li>
              <li><img class="weatherIcon" ng-src="{{ locationsCtrl.currentPosition.image }}" alt="{{ locationsCtrl.currentPosition.weather.weather[0].description }}"></li>
              <li>{{ locationsCtrl.currentPosition.weather.main.temp | number:0 }}°</li>
              <li class="condition">{{ locationsCtrl.currentPosition.weather.weather[0].description }}</li>
            </ul>
          </div>
        </ui-gmap-window>
      </ui-gmap-marker>

    </ui-gmap-google-map>
  </div>

</div>
